# 要件定義書 - AWS IAM 検証環境（Simple）

## 概要

最もシンプルな AWS 環境を構築します。単一サービス（Lambda → S3）の連携により、基本的な権限付与パターンを実装し、動作確認を行います。

## 用語集

- **Lambda 関数**: AWS Lambda 関数（Node.js 20.x or 22.x）
- **S3 バケット**: AWS S3 バケット（JSON ファイル格納用）
- **CDK スタック**: AWS CDK v2 によるインフラ定義
- **Grant メソッド**: CDK の標準的な権限付与メソッド（s3.grantRead 等）

## 要件

### 要件 1: Lambda 関数の実装

**ユーザーストーリー:** 開発者として、S3 から JSON ファイルを読み込む Lambda 関数を作成したい。基本的な IAM 権限の動作を確認するため。

#### 受け入れ基準

1. Lambda 関数は Node.js 20.x または 22.x ランタイムを使用する
2. Lambda 関数は AWS SDK v3 を使用して S3 操作を行う
3. Lambda 関数が呼び出されたとき、S3 バケットから特定の JSON ファイルを読み込む
4. JSON ファイルの読み込みが成功したとき、その内容をコンソールに出力する
5. Lambda 関数はエラーを適切に処理し、適切なエラーメッセージをログに記録する

### 要件 2: S3 バケットの設定

**ユーザーストーリー:** 開発者として、適切なアクセス制御を持つ S3 バケットを設定したい。Lambda 関数が安全に JSON ファイルを読み込めるようにするため。

#### 受け入れ基準

1. S3 バケットは AWS CDK v2 を使用して作成される
2. S3 バケットにはテスト用のサンプル JSON ファイルが少なくとも 1 つ含まれる
3. S3 バケットはデフォルト暗号化（AES256）を使用する
4. S3 バケットは IAM ポリシーを通じて Lambda 関数のみがアクセス可能である

### 要件 3: CDK インフラ定義

**ユーザーストーリー:** 開発者として、TypeScript で CDK を使用してインフラを定義したい。環境を一貫してデプロイ・管理するため。

#### 受け入れ基準

1. CDK スタックは TypeScript で実装される
2. CDK スタックは AWS CDK v2 を使用する
3. CDK スタックは初期権限設定に Grant メソッド（s3.grantRead）を使用する
4. CDK スタックは Lambda 関数と S3 バケットの両方のリソースを作成する
5. CDK スタックは任意の AWS リージョンにデプロイ可能である

### 要件 4: 動作確認

**ユーザーストーリー:** 開発者として、CDK 生成の権限で正常に動作することを確認したい。実装が正しく機能することを保証するため。

#### 受け入れ基準

1. Lambda 関数には AWS SDK v3 の具体的な呼び出しが含まれる
2. CDK スタックは標準の grant メソッドを使用して IAM ポリシーを生成する
3. Lambda 関数は CDK 生成の権限で正常に実行される
4. S3 からのファイル読み込みが成功し、内容が正しく出力される

### 要件 5: プロジェクト構成

**ユーザーストーリー:** 開発者として、整理されたプロジェクト構成を持ちたい。検証環境を簡単に保守・拡張するため。

#### 受け入れ基準

1. プロジェクトは CDK コード用の明確なディレクトリ構造を持つ
2. Lambda 関数のコードはインフラコードから分離される
3. プロジェクトには適切な package.json と依存関係が含まれる
4. プロジェクトにはデプロイ手順とドキュメントが含まれる
