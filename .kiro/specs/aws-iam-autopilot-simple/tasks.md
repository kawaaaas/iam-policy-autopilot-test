# 実装計画: AWS IAM 検証環境（Simple）

## 概要

Lambda 関数が S3 バケットから JSON ファイルを読み込む最もシンプルな AWS 環境を実装します。CDK v2 と TypeScript を使用し、標準的な grant メソッドによる権限付与で動作確認を行います。

## タスク

- [-] 1. プロジェクト構造と CDK 初期設定

  - TypeScript CDK プロジェクトの初期化
  - 必要な依存関係の追加（AWS SDK v3、CDK v2）
  - プロジェクトディレクトリ構造の作成
  - _要件: 5.1, 5.3_

- [ ] 2. S3 バケットとサンプルデータの作成

  - [ ] 2.1 CDK で S3 バケットリソースを定義

    - デフォルト暗号化（AES256）の設定
    - 検証用の removalPolicy 設定
    - _要件: 2.1, 2.3_

  - [ ] 2.2 サンプル JSON ファイルの作成とデプロイ
    - sample.json ファイルの作成
    - CDK Deployment でファイルをバケットにアップロード
    - _要件: 2.2_

- [ ] 3. Lambda 関数の実装

  - [ ] 3.1 Lambda 関数のコア実装

    - Node.js 22.x 用のハンドラー関数作成
    - AWS SDK v3 を使用した S3 GetObject 実装
    - JSON ファイル読み込みとコンソール出力
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [ ]\* 3.2 プロパティテスト: S3 ファイル読み込み成功

    - **プロパティ 1: S3 ファイル読み込み成功**
    - **検証対象: 要件 1.3, 1.4**

  - [ ] 3.3 エラーハンドリングの実装

    - NoSuchKey、AccessDenied 等の S3 エラー処理
    - 適切なログ出力とエラーメッセージ
    - _要件: 1.5_

  - [ ]\* 3.4 プロパティテスト: エラーハンドリング
    - **プロパティ 2: エラーハンドリング**
    - **検証対象: 要件 1.5**

- [ ] 4. CDK スタックの統合

  - [ ] 4.1 Lambda 関数リソースの定義

    - CDK で Lambda 関数リソース作成
    - 環境変数の設定（バケット名等）
    - Node.js 22.x ランタイムの指定
    - _要件: 3.1, 3.4_

  - [ ] 4.2 IAM 権限の設定

    - s3.grantRead()メソッドによる権限付与
    - Lambda 実行ロールの自動生成確認
    - _要件: 3.3, 2.4_

  - [ ]\* 4.3 プロパティテスト: 権限の最小化
    - **プロパティ 3: 権限の最小化**
    - **検証対象: 要件 2.4, 3.3**

- [ ] 5. チェックポイント - 基本動作確認

  - すべてのテストが通ることを確認し、質問があればユーザーに確認する

- [ ] 6. デプロイとテスト

  - [ ] 6.1 CDK スタックのデプロイ

    - cdk deploy コマンドで AWS にデプロイ
    - リソース作成の確認
    - _要件: 3.5_

  - [ ] 6.2 Lambda 関数の動作テスト

    - AWS CLI またはコンソールで Lambda 関数実行
    - S3 ファイル読み込みの成功確認
    - コンソール出力の確認
    - _要件: 4.3, 4.4_

  - [ ]\* 6.3 統合テスト
    - エンドツーエンドの動作確認
    - エラーケースのテスト
    - _要件: 4.1, 4.2_

- [ ] 7. ドキュメントとクリーンアップ

  - [ ] 7.1 README.md の作成

    - デプロイ手順の記述
    - 使用方法とテスト方法の説明
    - _要件: 5.4_

  - [ ] 7.2 クリーンアップ手順の確認
    - cdk destroy でリソース削除確認
    - コスト発生の確認
    - _要件: 5.4_

## 注意事項

- `*`マークのタスクはオプションで、コア機能を優先して MVP を早く作成できます
- 各タスクは特定の要件への追跡可能性のため要件番号を参照しています
- チェックポイントで段階的な検証を行います
- プロパティテストは汎用的な正確性プロパティを検証します
- ユニットテストは特定の例とエッジケースを検証します
